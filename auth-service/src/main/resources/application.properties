# ========================================
# APPLICATION CONFIGURATION
# ========================================
quarkus.application.name=auth-service
quarkus.http.port=${PORT:8080}

app.backend.url=${BACKEND_URL:http://localhost:8080}
app.frontend.url=${FRONTEND_URL:http://localhost:3000}

# ========================================
# DATABASE CONFIGURATION (Supabase)
# ========================================
quarkus.datasource.db-kind=postgresql
quarkus.datasource.jdbc.driver=org.postgresql.Driver

# Production (Render) - Using Session Pooler Port 5432
%prod.quarkus.datasource.jdbc.url=${DATABASE_URL}
%prod.quarkus.datasource.username=${DATABASE_USERNAME}
%prod.quarkus.datasource.password=${DATABASE_PASSWORD}

# Default Local
quarkus.datasource.jdbc.url=jdbc:postgresql://localhost:5432/authentication
quarkus.datasource.username=postgres
quarkus.datasource.password=12lpactc

# ========================================
# SECURITY & JWT SIGNING (The literal fix)
# ========================================
# 1. FORCE the builder to use Symmetric HS256
smallrye.jwt.new-token.signature-algorithm=HS256

# 2. Tell Quarkus the key is a raw secret string (NOT a file path)
# We use 'smallrye.jwt.sign.key' but ensure the value has no extra characters
smallrye.jwt.sign.key=${JWT_SIGNING_KEY}

# 3. VERIFICATION (Matches the above)
mp.jwt.verify.publickey=${JWT_SIGNING_KEY}
mp.jwt.verify.publickey.algorithm=HS256
mp.jwt.verify.issuer=oppex-ai
smallrye.jwt.new-token.issuer=oppex-ai

# Public Paths
quarkus.http.auth.permission.public.paths=/api/auth/signup,/api/auth/login,/api/auth/verify,/api/auth/resend-verification,/q/swagger-ui/*,/q/openapi,/q/health/*
quarkus.http.auth.permission.public.policy=permit

# Authenticated Paths
quarkus.http.auth.permission.authenticated.paths=/*
quarkus.http.auth.permission.authenticated.policy=authenticated

# ========================================
# CORS & EMAIL
# ========================================
quarkus.http.cors."*".origins=http://localhost:3000,http://localhost:5173,http://localhost:3001,https://oppenxai-auth-service.vercel.app,https://auth-service-qav9.onrender.com,https://auth-frontend-swo7.onrender.com
quarkus.http.cors."*".methods=GET,POST,PUT,DELETE,OPTIONS
quarkus.http.cors."*".headers=accept,authorization,content-type,x-requested-with
quarkus.http.cors."*".access-control-allow-credentials=true

resend.api.key=${RESEND_API_KEY}

# ========================================
# HIBERNATE & TEST
# ========================================
quarkus.hibernate-orm.database.generation=update
%prod.quarkus.hibernate-orm.log.sql=false

%test.quarkus.datasource.db-kind=h2
%test.quarkus.datasource.jdbc.url=jdbc:h2:mem:testdb
%test.quarkus.hibernate-orm.database.generation=drop-and-create