# ========================================
# APPLICATION CONFIGURATION
# ========================================
quarkus.application.name=auth-service
quarkus.http.port=${PORT:8080}

app.backend.url=${BACKEND_URL:http://localhost:8080}
app.frontend.url=${FRONTEND_URL:http://localhost:3000}

# ========================================
# DATABASE CONFIGURATION (Supabase)
# ========================================
quarkus.datasource.db-kind=postgresql
quarkus.datasource.jdbc.driver=org.postgresql.Driver

# Default Local
quarkus.datasource.jdbc.url=jdbc:postgresql://localhost:5432/authentication
quarkus.datasource.username=postgres
quarkus.datasource.password=12lpactc

# Production (Render) - Using Session Pooler Port 5432
%prod.quarkus.datasource.jdbc.url=${DATABASE_URL}
%prod.quarkus.datasource.username=${DATABASE_USERNAME}
%prod.quarkus.datasource.password=${DATABASE_PASSWORD}

# ========================================
# SECURITY & JWT SIGNING (Fixes SRJWT05009)
# ========================================
# Symmetric Signing Key (Must be at least 32 characters)
# In Render, add JWT_SIGNING_KEY as an Env Var
smallrye.jwt.sign.key=${JWT_SIGNING_KEY:a-very-long-secret-key-at-least-32-chars-long}
smallrye.jwt.new-token.issuer=oppex-ai

# Verification settings
mp.jwt.verify.issuer=oppex-ai

# Public Paths
quarkus.http.auth.permission.public.paths=/api/auth/signup,/api/auth/login,/api/auth/verify,/api/auth/resend-verification,/q/swagger-ui/*,/q/openapi,/q/health/*
quarkus.http.auth.permission.public.policy=permit

# Authenticated Paths
quarkus.http.auth.permission.authenticated.paths=/*
quarkus.http.auth.permission.authenticated.policy=authenticated

# ========================================
# CORS & EMAIL
# ========================================
quarkus.http.cors."*".origins=http://localhost:3000,http://localhost:5173,http://localhost:3001,https://oppenxai-auth-service.vercel.app,https://auth-service-qav9.onrender.com,https://auth-frontend-swo7.onrender.com
quarkus.http.cors."*".methods=GET,POST,PUT,DELETE,OPTIONS
quarkus.http.cors."*".headers=accept,authorization,content-type,x-requested-with
quarkus.http.cors."*".access-control-allow-credentials=true

resend.api.key=${RESEND_API_KEY}

# ========================================
# HIBERNATE & TEST
# ========================================
quarkus.hibernate-orm.database.generation=update
%prod.quarkus.hibernate-orm.log.sql=false

%test.quarkus.datasource.db-kind=h2
%test.quarkus.datasource.jdbc.url=jdbc:h2:mem:testdb
%test.quarkus.hibernate-orm.database.generation=drop-and-create